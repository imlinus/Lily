var Lily=function(){"use strict";!function(t){function e(t){return r[s]=t,i(s),s++}function n(t){delete r[t]}function o(t){if(a)setTimeout(o,0,t);else{var e=r[t];if(e){a=!0;try{e()}finally{n(t),a=!1}}}}if(!t.setImmediate){var i,r={},s=1,a=!1;"[object process]"==={}.toString.call(t.process)?function(){i=function(t){process.nextTick(function(){o(t)})}}():function(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&o(+n.data.slice(e.length))};t.addEventListener("message",n,!1),i=function(n){t.postMessage(e+n,"*")}}(),t.setImmediate=e,t.clearImmediate=n}}("undefined"==typeof self?"undefined"==typeof global?window:global:self);var t=new WeakMap,e=Symbol(),n=Symbol(),o=Symbol(),i=Symbol(),r=Symbol(),s={watch:function(e){if("function"!=typeof e)throw"Sorry";return t.has(this)||t.set(this,[]),t.get(this).push(e),this},unwatch:function(e){var n=t.get(this);if(n){if(e){var o=n.indexOf(e);~o&&n.splice(o,1)}else t.set(this,[]);return this}},json:function(){var t=this;return Object.keys(this).reduce(function(e,n){var o=t[n];return e[n]=o&&o.json?o.json():o,e},this[i]?[]:{})}},a={set:function(t,o,i){return t[o]!==i&&(i!==Object(i)||i[n]?t[o]=i:t[o]=icaro(i),t[e](o,i)),!0}},c=function(t,e,n){Object.defineProperty(t,e,{value:n,enumerable:!1,configurable:!1,writable:!1})},l=function(l){var u;return Object.assign(l,(u={},u[r]=new Map,u[o]=null,u[n]=!0,u[e]=function(e,n){t.has(l)&&(clearImmediate(l[o]),l[r].set(e,n),l[o]=setImmediate(function(){t.get(l).forEach(function(t){return t(l[r])}),l[r].clear()}))},u)),Object.keys(s).forEach(function(t){c(l,t,s[t].bind(l))}),Array.isArray(l)&&(l[i]=!0,l.forEach(function(t,e){l[e]=null,a.set(l,e,t)})),l},u=function(t){return new Proxy(l(t||{}),Object.create(a))},h={elementNode:function(t){return 1===t.nodeType},textNode:function(t){return 3===t.nodeType},obj:function(t){return null!=t&&"object"==typeof t},arr:function(t){return Array.isArray(t)}},d=function(t){this.vm=t;var e=this.vm.__proto__;return e.beforeMount&&e.beforeMount(),this.vm.components&&(this.components=this.vm.components()),this.vm.template&&(this.template=this.html(this.vm.template())),this.walkNodes(this.template),this.nodes(this.template),e.mounted&&e.mounted(),this.template};d.prototype.html=function(t){if(t){var e=document.createElement("html");return e.innerHTML=t.trim(),e.children[1].firstChild}},d.prototype.nodes=function(t){for(var e=t.parentNode.querySelectorAll("*"),n=0;n<e.length;n++)this.checkAttrs(e[n].attributes)},d.prototype.checkAttrs=function(t){var e=this;return Object.values(t).reduce(function(t,n){var o=n.ownerElement,i=n.nodeValue,r=n.nodeName;return/model/.test(r)?e.model(o,i,r):/@/.test(r)?e.on(o,i,r):/loop/.test(r)?e.loop(o,i,r):void 0},[])},d.prototype.walkNodes=function(t){if(t)for(var e=t.childNodes,n=0;n<e.length;n++){var o=e[n],i=/\{\{(.*)\}\}/,r=o.textContent;i.test(r)&&this.text(o,i.exec(r)[1].trim()),h.elementNode(o)&&this.components&&this.components.hasOwnProperty(o.localName)&&new(0,this.components[o.localName])(o),o.childNodes&&0!==o.childNodes.length&&this.walkNodes(o)}},d.prototype.text=function(t,e){var n=this.vm.data[e];t.textContent=n,this.vm.data.watch(function(n){t.textContent=n.get(e)})},d.prototype.on=function(t,e,n){var o=this,i=n.substr(1);t.addEventListener(i,function(){o.vm[e]&&o.vm[e](event)})},d.prototype.model=function(t,e,n){var o=this;return t.addEventListener("input",function(){o.vm.data[e]=t.value}),t.value=this.vm.data[e]},d.prototype.loop=function(t,e,n){var o=e.split("in")[1].replace(/\s/g,""),i=this.vm.data[o],r=t.parentNode;r.removeChild(t);for(var s=0;s<i.length;s++){var a=i[s],c=document.createElement(t.localName);c.textContent=a,r.appendChild(c)}};var f=function(t){return new d(t)},m=function(t){this.el=t&&t instanceof HTMLElement?t:t=document.body,this.data()&&(this.data=u(this.data())),this.template=f(this),this.render(),console.log(this)};return m.prototype.render=function(){"body"===this.el.localName?this.el.appendChild(this.template):this.el.parentNode.replaceChild(this.template,this.el)},m.mount=function(t){return new t},m}();

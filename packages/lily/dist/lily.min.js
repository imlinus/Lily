<<<<<<< HEAD
var is={elementNode:function(t){return 1===t.nodeType},textNode:function(t){return 3===t.nodeType},obj:function(t){return null!=t&&"object"==typeof t},arr:function(t){return Array.isArray(t)}},getObj=function(t,e){if(void 0===e&&(e={}),!t||is.obj(t))return t;var n=JSON.parse(JSON.stringify(t));for(var r in n)"object"!=typeof n[r]?e[r]=n[r]:"object"==typeof n[r]&&void 0!==n[r].___value?e[r]=n[r].___value:is.arr(n[r])?e[r]=n[r].splice(0):"object"==typeof n[r]&&(e[r]=getObj(n[r],{}));return e},watch=function(t,e,n,r,o){t&&t.watch&&"function"==typeof t.watch&&t.watch(getObj(t),getObj(n),r,o)},handler=function(t){return{get:function(t,e,n){return t[e]},deleteProperty:function(e,n){var r,o=getObj(t);return(is.obj(e)||is.arr(e))&&(r=delete e[n]),watch(t,o,e,n),r},set:function(e,n,r){var o=getObj(t);return is.arr(e)&&"length"===n?(e[n]=r,e):(is.arr(r)&&(e[n]=new Proxy(r,handler)),is.obj(r)&&!is.arr(r)&&(e[n]=new Observer(r,{},t)),is.obj(r)||(e[n]=r),watch(t,o,e,n,r),e)}}},Observer=function t(e,n,r){if(is.obj(e)&&!is.arr(e)){for(var o=Object.keys(e),i=0;i<o.length;i++)"object"==typeof e[o[i]]?n[o[i]]=new t(e[o[i]],{},r):n[o[i]]=e[o[i]];return new Proxy(n,handler(r||e))}return is.arr(e)?new Proxy(e,handler(r||e)):is.obj(e)?void 0:e},observe=function(t){var e={};try{return new Observer(t,e,e)}catch(e){return t}},Compiler=function(t){this.vm=t;var e=this.vm.__proto__;return e.beforeMount&&e.beforeMount(),this.vm.components&&(this.components=this.vm.components()),this.vm.template&&(this.template=this.html(this.vm.template())),this.walkNodes(this.template),this.nodes(this.template),e.mounted&&e.mounted(),this.template};Compiler.prototype.html=function(t){if(t){var e=document.createElement("html");return e.innerHTML=t.trim(),e.children[1].firstChild}},Compiler.prototype.nodes=function(t){for(var e=t.parentNode.querySelectorAll("*"),n=0;n<e.length;n++)this.checkAttrs(e[n].attributes)},Compiler.prototype.checkAttrs=function(t){var e=this;return Object.values(t).reduce(function(t,n){var r=n.ownerElement,o=n.nodeValue,i=n.nodeName;return/model/.test(i)?e.model(r,o,i):/@/.test(i)?e.on(r,o,i):void 0},[])},Compiler.prototype.walkNodes=function(t){if(t)for(var e=t.childNodes,n=0;n<e.length;n++){var r=e[n],o=/\{\{(.*)\}\}/,i=r.textContent;o.test(i)&&this.text(r,o.exec(i)[1].trim()),is.elementNode(r)&&this.components&&this.components.hasOwnProperty(r.localName)&&new(0,this.components[r.localName])(r),r.childNodes&&0!==r.childNodes.length&&this.walkNodes(r)}},Compiler.prototype.text=function(t,e){var n=this.vm.data[e];t.textContent=n,this.vm.data.watch=function(n){t.textContent=n[e]}},Compiler.prototype.on=function(t,e,n){var r=this,o=n.substr(1);t.addEventListener(o,function(){r.vm[e]&&r.vm[e](event)})},Compiler.prototype.model=function(t,e,n){var r=this;return t.addEventListener("input",function(){r.vm.data[e]=t.value}),t.value=this.vm.data[e]};var compiler=function(t){return new Compiler(t)},Lily=function(t){this.el=t&&t instanceof HTMLElement?t:t=document.body,this.data=observe(this.data()),this.template=compiler(this),this.render()};Lily.prototype.render=function(){"body"===this.el.localName?this.el.appendChild(this.template):this.el.parentNode.replaceChild(this.template,this.el)},Lily.mount=function(t){return new t};export default Lily;
=======
"use strict";var Dep=function(){this.subs=new Map};Dep.prototype.addSub=function(t,e){var n=this.subs.get(t);n?n.add(e):this.subs.set(t,new Set([e]))},Dep.prototype.notify=function(t){this.subs.get(t)&&this.subs.get(t).forEach(function(t){return t.update()})};var q=new Set,nextTick=function(t){Promise.resolve().then(t)},flush=function(t){q.forEach(function(t){return t.run()}),q=new Set},queue=function(t){q.add(t),nextTick(flush)},Watcher=function(t,e,n){this.vm=t,this.exp=e,this.cb=n,this.value=this.get()};Watcher.prototype.get=function(){var t,e=this.exp;return Dep.target=this,"function"==typeof e?t=e.call(this.vm):"string"==typeof e&&(t=this.vm[e]),Dep.target=null,t},Watcher.prototype.update=function(){queue(this)},Watcher.prototype.run=function(){var t=this.get();this.cb.call(this.vm,t,this.value),this.value=t};var elementNode=function(t){return 1===t.nodeType},textNode=function(t){return 3===t.nodeType},html=function(t){if(t){var e=document.createElement("html");return e.innerHTML=t.trim(),e.children[1].firstChild}},Compile=function(t){this.vm=t;var e=this.vm.__proto__;e.beforeMount&&e.beforeMount(),this.vm.components&&(this.c=this.vm.components()),this.vm.template&&(this.t=html(this.vm.template())),this.walkNodes(this.t),this.nodes(this.t),e.mounted&&e.mounted()};Compile.prototype.nodes=function(t){for(var e=t.parentNode.querySelectorAll("*"),n=0;n<e.length;n++)this.check(e[n].attributes)},Compile.prototype.check=function(t){var e=this;return Object.values(t).reduce(function(t,n){var o=n.nodeName,i=n.nodeValue,r=n.ownerElement;return/:style/.test(o)?e.style(r,i,o):/bind/.test(o)?e.bind(r,i,o):/@/.test(o)?e.on(r,i,o):/loop/.test(o)?e.loop(r,i,o):void 0},[])},Compile.prototype.walkNodes=function(t){if(t)for(var e=t.childNodes,n=0;n<e.length;n++){var o=e[n],i=/\{\{(.*)\}\}/,r=o.textContent;elementNode(o)?this.c&&this.c.hasOwnProperty(o.localName)&&new(0,this.c[o.localName])(o):textNode(o)&&i.test(r)&&this.compileText(o,i.exec(r)[1].trim()),o.childNodes&&0!==o.childNodes.length&&this.walkNodes(o)}},Compile.prototype.compileText=function(t,e){if(this.vm.data){var n=this.vm.data[e];t.textContent=n,new Watcher(this.vm,e,function(e){t.textContent=e||""})}},Compile.prototype.on=function(t,e,n){var o=this,i=n.substr(1);t.addEventListener(i,function(){o.vm[e]&&o.vm[e](event)})},Compile.prototype.loop=function(t,e,n){var o=e.split("in")[1].replace(/\s/g,""),i=this.vm.data[o],r=t.parentNode;r.removeChild(t);for(var s=0;s<i.length;s++){var a=i[s],c=document.createElement(t.localName);c.textContent=a,r.appendChild(c)}},Compile.prototype.bind=function(t,e,n){var o=this;return t.addEventListener("input",function(){o.vm.data[e]=t.value}),new Watcher(this.vm,n,function(e){t.value=e}),t.value=this.vm.data[e]},Compile.prototype.style=function(t,e,n){var o=this.vm.data[e];t.classList.add(o)};var Observer=function(t){var e=new Dep;return new Proxy(t,{get:function(t,n,o){return Dep.target&&e.addSub(n,Dep.target),Reflect.get(t,n,o)},set:function(t,n,o,i){if(Reflect.get(i,n)!==o){var r=Reflect.set(t,n,observ(o),i);return e.notify(n),r}}})},observ=function(t){return"[object Object]"===!Object.prototype.toString.call(t)?t:(Object.keys(t).forEach(function(e){t[e]=observ(t[e])}),Observer(t))},Lily=function(t){this.el=t&&t instanceof HTMLElement?t:t=document.body,this.data&&(this.data=observ(this.data())),this.reactive(),this.template=new Compile(this).t,this.render(),console.log(this)};Lily.prototype.render=function(){"body"===this.el.localName?this.el.appendChild(this.template):this.el.parentNode.replaceChild(this.template,this.el)},Lily.prototype.get=function(t){return this.data[t]},Lily.prototype.set=function(t){this.data[key]=val},Lily.prototype.reactive=function(){for(var t=this,e=Object.keys(this.data),n=0;n<e.length;n++)!function(n){var o=e[n];Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:function(){return this.data[o]},set:function(t){this.data[o]=t}})}(n)},Lily.mount=function(t){return new t},Lily.use=function(t){return new t},Lily.prototype.config={silent:!1},module.exports=Lily;
>>>>>>> d80b7c8dbd1df16056b8497074c8e1ada089f68a

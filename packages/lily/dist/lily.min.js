var is={elementNode:function(t){return 1===t.nodeType},textNode:function(t){return 3===t.nodeType},obj:function(t){return null!=t&&"object"==typeof t},arr:function(t){return Array.isArray(t)}},getObj=function(t,e){if(void 0===e&&(e={}),!t||is.obj(t))return t;var n=JSON.parse(JSON.stringify(t));for(var o in n)"object"!=typeof n[o]?e[o]=n[o]:"object"==typeof n[o]&&void 0!==n[o].___value?e[o]=n[o].___value:is.arr(n[o])?e[o]=n[o].splice(0):"object"==typeof n[o]&&(e[o]=getObj(n[o],{}));return e},watch=function(t,e,n,o,r){t&&t.watch&&"function"==typeof t.watch&&t.watch(getObj(t),getObj(n),o,r)},handler=function(t){return{get:function(t,e,n){return t[e]},deleteProperty:function(e,n){var o,r=getObj(t);return(is.obj(e)||is.arr(e))&&(o=delete e[n]),watch(t,r,e,n),o},set:function(e,n,o){var r=getObj(t);return is.arr(e)&&"length"===n?(e[n]=o,e):(is.arr(o)&&(e[n]=new Proxy(o,handler)),is.obj(o)&&!is.arr(o)&&(e[n]=new Observer(o,{},t)),is.obj(o)||(e[n]=o),watch(t,r,e,n,o),e)}}},Observer=function t(e,n,o){if(is.obj(e)&&!is.arr(e)){for(var r=Object.keys(e),i=0;i<r.length;i++)"object"==typeof e[r[i]]?n[r[i]]=new t(e[r[i]],{},o):n[r[i]]=e[r[i]];return new Proxy(n,handler(o||e))}return is.arr(e)?new Proxy(e,handler(o||e)):is.obj(e)?void 0:e},observe=function(t){var e={};try{return new Observer(t,e,e)}catch(e){return t}},Compiler=function(t){this.vm=t;var e=this.vm.__proto__;return e.beforeMount&&e.beforeMount(),this.vm.components&&(this.components=this.vm.components()),this.vm.template&&(this.template=this.html(this.vm.template())),this.walkNodes(this.template),this.nodes(this.template),e.mounted&&e.mounted(),this.template};Compiler.prototype.html=function(t){if(t){var e=document.createElement("html");return e.innerHTML=t.trim(),e.children[1].firstChild}},Compiler.prototype.nodes=function(t){for(var e=t.parentNode.querySelectorAll("*"),n=0;n<e.length;n++)this.checkAttrs(e[n].attributes)},Compiler.prototype.checkAttrs=function(t){var e=this;return Object.values(t).reduce(function(t,n){var o=n.ownerElement,r=n.nodeValue,i=n.nodeName;return/model/.test(i)?e.model(o,r,i):/@/.test(i)?e.on(o,r,i):/loop/.test(i)?e.loop(o,r,i):void 0},[])},Compiler.prototype.walkNodes=function(t){if(t)for(var e=t.childNodes,n=0;n<e.length;n++){var o=e[n],r=/\{\{(.*)\}\}/,i=o.textContent;r.test(i)&&this.text(o,r.exec(i)[1].trim()),is.elementNode(o)&&this.components&&this.components.hasOwnProperty(o.localName)&&new(0,this.components[o.localName])(o),o.childNodes&&0!==o.childNodes.length&&this.walkNodes(o)}},Compiler.prototype.text=function(t,e){var n=this.vm.data[e];t.textContent=n,this.vm.data.watch=function(n){t.textContent=n[e]}},Compiler.prototype.on=function(t,e,n){var o=this,r=n.substr(1);t.addEventListener(r,function(){o.vm[e]&&o.vm[e](event)})},Compiler.prototype.model=function(t,e,n){var o=this;return t.addEventListener("input",function(){o.vm.data[e]=t.value}),t.value=this.vm.data[e]},Compiler.prototype.loop=function(t,e,n){var o=e.split("in")[1].replace(/\s/g,""),r=this.vm.data[o],i=t.parentNode;i.removeChild(t);for(var a=0;a<r.length;a++){var s=r[a],l=document.createElement(t.localName);l.textContent=s,i.appendChild(l)}this.vm.data.watch=function(t){console.log(t[o])}};var compiler=function(t){return new Compiler(t)},Lily=function(t){this.el=t&&t instanceof HTMLElement?t:t=document.body,this.data=observe(this.data()),this.template=compiler(this),this.render()};Lily.prototype.render=function(){"body"===this.el.localName?this.el.appendChild(this.template):this.el.parentNode.replaceChild(this.template,this.el)},Lily.mount=function(t){return new t};export default Lily;

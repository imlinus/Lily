function observe(t,e){var n={},o=[],r=[];return new Proxy(t||{},{get:function(t,o,i){var a=Reflect.get.apply(Reflect,arguments);return"object"==typeof a||void 0===a?n[o]||(n[o]=observe(a||{},function(n,i,a){var c,l,s=Object.assign({},t,(c={},c[o]=i,c)),u=Object.assign({},t,(l={},l[o]=n,l));r.length&&r.forEach(function(t){return t(u,s,o+"."+a)}),"function"==typeof e&&e(u,s,o+"."+a)})):a},set:function(t,n,i){if(n===REVEAL_ADD_FLAT_CALLBACK)return o.push(i);if(n===REVEAL_ADD_DEEP_CALLBACK)return r.push(i);if(n===REVEAL_REMOVE_FLAT_CALLBACK)return o=o.filter(function(t){return t!==i});if(n===REVEAL_REMOVE_DEEP_CALLBACK)return r=r.filter(function(t){return t!==i});var a=t[n],c=Object.assign({},t),l=Reflect.set.apply(Reflect,arguments);return l&&i!==a&&(o.length&&o.forEach(function(e){return e(t,c,n)}),r.length&&r.forEach(function(e){return e(t,c,n)}),"function"==typeof e&&e(t,c,n)),l}})}function watcher(t,e,n){var o=(n=Object.assign({},{deep:!1,immediate:!1},n)).deep?{add:REVEAL_ADD_DEEP_CALLBACK,remove:REVEAL_REMOVE_DEEP_CALLBACK}:{add:REVEAL_ADD_FLAT_CALLBACK,remove:REVEAL_REMOVE_FLAT_CALLBACK};return t[o.add]=e,n.immediate&&e(t),function(){t[o.remove]=e}}var REVEAL_ADD_DEEP_CALLBACK="__REVEAL_ADD_DEEP_CALLBACK__",REVEAL_ADD_FLAT_CALLBACK="__REVEAL_ADD_FLAT_CALLBACK__",REVEAL_REMOVE_DEEP_CALLBACK="__REVEAL_REMOVE_DEEP_CALLBACK__",REVEAL_REMOVE_FLAT_CALLBACK="__REVEAL_REMOVE_FLAT_CALLBACK__",Compiler=function(t){var e=t.data,n=t.components,o=t.template;this.vm=t;var r=this.vm.__proto__;return r.beforeMount&&r.beforeMount(),e&&(this.data=e),n&&(this.components=n()),o&&(this.template=this.html(o())),this.walkNodes(this.template),this.nodes(this.template),r.mounted&&r.mounted(),this.template};Compiler.prototype.html=function(t){if(t){var e=document.createElement("html");return e.innerHTML=t.trim(),e.children[1].firstChild}},Compiler.prototype.walkNodes=function(t){var e=this;t&&t.childNodes.forEach(function(t){var n=/\{\{(.*)\}\}/,o=t.textContent;n.test(o)&&e.text(t,n.exec(o)[1].trim()),1===t.nodeType&&e.components&&e.components.hasOwnProperty(t.localName)&&new(0,e.components[t.localName])(t),t.childNodes&&0!==t.childNodes.length&&e.walkNodes(t)})},Compiler.prototype.nodes=function(t){var e=this;t.parentNode.querySelectorAll("*").forEach(function(t){return e.checkAttrs(t.attributes)})},Compiler.prototype.checkAttrs=function(t){var e=this;return Object.values(t).reduce(function(t,n){var o={el:n.ownerElement,key:n.nodeValue,exp:n.nodeName},r=o.el,i=o.key,a=o.exp;return/model/.test(a)?e.model(r,i,a):/@/.test(a)?e.on(r,i,a):/loop/.test(a)?e.loop(r,i,a):void 0},[])},Compiler.prototype.text=function(t,e){var n=this.data[e];n.constructor!==Object&&(t.textContent=n),watcher(this.data,function(n){t.textContent=n[e]})},Compiler.prototype.model=function(t,e,n){var o=this;return t.addEventListener("input",function(){o.data[e]=t.value}),t.value=this.data[e].constructor===Object?"":this.data[e]},Compiler.prototype.on=function(t,e,n){var o=this,r=n.substr(1);t.addEventListener(r,function(){o.vm[e]&&o.vm[e](event)})},Compiler.prototype.loop=function(t,e,n){var o=e.split("in")[1].replace(/\s/g,""),r=this.data[o],i=t.parentNode;i.removeChild(t);var a=function(e){var n=document.createElement(t.localName);n.textContent=e,i.appendChild(n)};r.forEach(function(t){return a(t)}),watcher(this.data,function(t){t[o].forEach(function(t){return a(t)})})};var compile=function(t){return new Compiler(t)},Lily=function(t){this.el=t&&t instanceof HTMLElement?t:t=document.body,this.data=observe(this.data()),this.template=compile(this),this.render()};Lily.prototype.render=function(){"body"===this.el.localName?this.el.appendChild(this.template):this.el.parentNode.replaceChild(this.template,this.el)},Lily.mount=function(t){return new t};export default Lily;

"use strict";var Watcher=function(t,e,i){this.vm=t,this.exp=e,this.cb=i,this.val=this.get()};Watcher.prototype.update=function(){var t=this.val,e=this.vm.data[this.exp];t!==e&&(this.val=e,this.cb.call(this.vm,e))},Watcher.prototype.get=function(){return this.vm.data[this.exp]};var Compile=function(t,e){this.view=t,this.el=e,this.init()};Compile.prototype.init=function(){this.run=this.view.__proto__,this.template=this.html(this.view.template),this.compileElement(this.template),this.el&&(console.log("el",this.el),this.el.appendChild(this.template))},Compile.prototype.html=function(t){var e=document.createElement("template");return e.innerHTML=t.trim(),e.content.firstChild},Compile.prototype.compileElement=function(t){for(var e=t.childNodes,i=0;i<e.length;i++){var o=e[i],n=/\{\{(.*)\}\}/,s=o.textContent;this.isElementNode(o)?this.compile(o):this.isTextNode(o)&&n.test(s)&&this.compileText(o,n.exec(s)[1].trim()),o.childNodes&&0!==o.childNodes.length&&this.compileElement(o)}},Compile.prototype.compileText=function(t,e){if(this.view.data){var i=this.view.data[e];t.textContent=i,new Watcher(this.view,e,function(e){t.textContent=e||""})}else if(this.view.props){t.attributes;console.log(this.view,t)}},Compile.prototype.compile=function(t){t.attributes;if(this.view.components){var e=this.view.components[t.localName];if(e){new Compile(e,this.template),t.parentNode;this.checkAttrs(t)}}else this.checkAttrs(t)},Compile.prototype.checkAttrs=function(t){for(var e=t.attributes,i=0;i<e.length;i++){var o=e[i];if(this.isModelDirective(o.name)){var n=t.tagName.toLowerCase();console.log("isModelDirective",n,t)}else if(this.isLoopDirective(o.name))console.log("isLoopDirective",t);else if(this.isEventDirective(o.name))console.log("isEventDirective",t);else if(this.isBindDirective(o.name)){var s=o.name.substr(1),r=o.nodeValue;console.log("isBindDirective",s,r,t)}}},Compile.prototype.isElementNode=function(t){return 1===t.nodeType},Compile.prototype.isTextNode=function(t){return 3===t.nodeType},Compile.prototype.isModelDirective=function(t){return"model"===t},Compile.prototype.isLoopDirective=function(t){return"loop"===t},Compile.prototype.isEventDirective=function(t){return-1!==t.indexOf("@")},Compile.prototype.isBindDirective=function(t){return t.startsWith(":")};var Lily=function(t,e){this.app=new t,this.el=e instanceof HTMLElement?e:e=document.body,this.defineReactive(this.app),new Compile(this.app,this.el),console.log(this.app)};Lily.prototype.defineReactive=function(t){for(var e=0,i=Object.entries(t);e<i.length;e+=1){var o=i[e],n=o[0],s=o[1];if("data"===n)for(var r=0,p=Object.keys(s);r<p.length;r+=1){var l=p[r];this.proxyData(t,l)}else if("components"===n)for(var c=0,a=Object.entries(s);c<a.length;c+=1){var h=a[c];this.defineReactive(h[1])}}},Lily.prototype.proxyData=function(t,e){Object.defineProperty(t,e,{configurable:!0,enumerable:!1,get:function(){return t.data[e]},set:function(i){t.data[e]=i}})},Lily.prototype.get=function(t){return this.app[t]},Lily.prototype.set=function(t,e){this.app[t]=e},module.exports=Lily;
